<!DOCTYPE html>
<html class="x-admin-sm">
    
    <head>
        <meta charset="UTF-8">
        <title>欢迎页面-X-admin2.2</title>
        <meta name="renderer" content="webkit">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <meta name="viewport" content="width=device-width,user-scalable=yes, minimum-scale=0.4, initial-scale=0.8,target-densitydpi=low-dpi" />
        <link rel="stylesheet" href="./css/font.css">
        <link rel="stylesheet" href="./css/xadmin.css">
        <script src="./lib/layui/layui.js" charset="utf-8"></script>
        <script type="text/javascript" src="./js/xadmin.js"></script>
    </head>
    
    <body>
        <div class="x-nav">
            <span class="layui-breadcrumb">
                <a href="">首页</a>
                <a href="">演示</a>
                <a>
                    <cite>导航元素</cite></a>
            </span>
            <a class="layui-btn layui-btn-small" style="line-height:1.6em;margin-top:3px;float:right" onclick="location.reload()" title="刷新">
                <i class="layui-icon layui-icon-refresh" style="line-height:30px"></i>
            </a>
        </div>
        <script type="text/html" id="operate">
            <button class="layui-btn layui-btn-normal" lay-event="query">query</button>
            <button class="layui-btn layui-btn-normal" lay-event="invoke">invoke</button>
        </script>
        <div class="layui-fluid">
            <div class="layui-row layui-col-space15">
                <div class="layui-col-md12">
                    <div class="layui-card">
                        <div class="layui-card-body ">
                            <div class="layui-tab">
                        <ul class="layui-tab-title">
                            <li class="layui-this">installed</li>
                            <li>Instantiate</li>
                        </ul>
                        <div class="layui-tab-content">
                            <div class="layui-tab-item layui-show">
                                <table class="layui-table" lay-data="{url:'/chaincode/listInstalled',id:'installedTable'}">
                                    <thead>
                                    <tr>
                                        <th lay-data="{field:'Name',width:'30%'}">name</th>
                                        <th lay-data="{field:'Version',width:''}">version</th>
                                    </thead>
                                </table>
                            </div>
                            <div class="layui-tab-item">
                                channel:
                                <select class="layui-select" id="channelSelect" onchange="changeChannel()">
                                </select>
                                <table class="layui-table" id="instantiateTable" lay-filter="instTableTool">
                                </table>
                            </div>
                        </div>
                    </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
    <script>
        var table;
        layui.use(['table'],function() {
            table = layui.table;
            table.on('tool(instTableTool)',function (obj) {
                eval(obj.event+'(obj)')
            });
            listChannels();
        });
        function initInstTable(channelID){
            table.render({
                elem: '#instantiateTable'
                ,url:'/chaincode/listInstantiate?channelID='+channelID
                ,cols: [[
                    {field:'Name', width:'30%', title: 'name', sort: true}
                    ,{field:'Version', width:'20%', title: 'version'}
                    ,{field:'', width:'50%', title: '操作',toolbar:'#operate' }
                ]]

            });
        }
        function listChannels(){
            $.ajax({
                type:"get",
                url:"/channel/listJson",
                dataType:"JSON",
                success:function (resp) {
                    var data = resp.data;
                    var html='';
                    var channel='';
                    if (data.length>0){
                        channel = data[0].Name;
                    }
                    for (var i=0;i<data.length;i++){
                        html = html + '<option>'+data[i].Name+'</option>'
                    }
                    $('#channelSelect').html(html);
                    initInstTable(channel);
                }
            });
        }
        function changeChannel() {
            initInstTable(channel);
        }
        function query(obj) {
            $.ajax({
                type:"post",
                url:"/chaincode/query",
                data:{channelID:$('#channelSelect').val(),chaincodeName:obj.data.Name,args:encodeURI('{"Args":["query","a"]}')},
                dataType:"text",
                success:function (resp) {
                    layer.msg(resp)
                }
            });
        }
        function invoke(obj) {
            $.ajax({
                type:"post",
                url:"/chaincode/invoke",
                data:{channelID:$('#channelSelect').val(),chaincodeName:obj.data.Name,args:encodeURI('{"Args":["invoke","a","b","2"]}')},
                dataType:"text",
                success:function (resp) {
                    layer.msg(resp)
                }
            });
        }
    </script>

</html>
